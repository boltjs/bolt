<?xml version="1.0" encoding="utf-8"?>
<Wix xmlns="http://schemas.microsoft.com/wix/2006/wi">
  <Product Name="bolt __VERSION__" Version="__VERSION__" Manufacturer="Ephox" Id="*" UpgradeCode="FEC7BFF2-5962-44B0-91E6-E329BC92FC37" Language="1033">
    <Package Id="*" InstallerVersion="100" Compressed="yes" />
    <Media Id="1" Cabinet="bolt.cab" EmbedCab="yes" />

    <Upgrade Id="FEC7BFF2-5962-44B0-91E6-E329BC92FC37">
      <!--
        This will unfortunately still allow downgrades from e.g. a.b.c.x to a.b.c.y, where x > y
        as Windows Installer only ever checks the first 3 digits of a version number. However for
        our purposes this should be acceptible.
      -->
      <UpgradeVersion Property="PREVIOUSFOUND" OnlyDetect="no" Minimum="1.0.0" Maximum="__VERSION__" IncludeMinimum="yes" IncludeMaximum="yes" />
      <UpgradeVersion Property="NEWERFOUND" OnlyDetect="yes" Minimum="__VERSION__" IncludeMinimum="no" />
    </Upgrade>

    <CustomAction Id="NoDowngrade" Error="A later version of bolt is already installed." />

    <InstallExecuteSequence>
      <Custom Action="NoDowngrade" After="FindRelatedProducts">NEWERFOUND</Custom>
      <RemoveExistingProducts Before="InstallInitialize" />
    </InstallExecuteSequence>

    <Directory Id="TARGETDIR" Name="SourceDir">
      <Directory Id="ProgramFilesFolder">
        <Directory Id="INSTALLDIR" Name="bolt">
          <Directory Id="bin" Name="bin" />
          <Directory Id="lib" Name="lib" />
          <Directory Id="command" Name="command" />
        </Directory>
      </Directory>
    </Directory>

    <DirectoryRef Id="INSTALLDIR">
      <Component Id="LICENSE" Guid="E9092D5E-3919-11E2-9C7B-0026BB5B376C">
        <File Id="LICENSE" Source="LICENSE" KeyPath="yes" />
      </Component>
      <Component Id="README.md" Guid="CC676FF6-C68C-4D58-8A73-DDFDFE617A0D">
          <File Id="README.md" Source="README.md" KeyPath="yes" />
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="bin">
      <Component Id="bin_bolt.bat" Guid="D09F4A8A-39C5-11E2-9C04-0026BB5B376C">
        <File Id="bin_bolt.bat" Source="bin/bolt.bat" KeyPath="yes" />
      </Component>
      <Component Id="bin_bolt.js" Guid="D8E8E840-39C5-11E2-B42A-0026BB5B376C">
        <File Id="bin_bolt.js" Source="bin/bolt.js" KeyPath="yes" />
      </Component>
      <Component Id="bin_jsc.bat" Guid="DDEDCA54-39C5-11E2-9B4C-0026BB5B376C">
        <File Id="bin_jsc.bat" Source="bin/jsc.bat" KeyPath="yes" />
      </Component>
      <Component Id="bin_jsc.js" Guid="E26DE9D8-39C5-11E2-B389-0026BB5B376C">
        <File Id="bin_jsc.js" Source="bin/jsc.js" KeyPath="yes" />
      </Component>
      <Component Id="bin_version" Guid="E6730FD6-39C5-11E2-B3AD-0026BB5B376C">
        <File Id="bin_version" Source="bin/version" KeyPath="yes" />
      </Component>
      <Component Id="UpdatePath" Guid="8C908A19-0C4F-41C3-A2BF-963B8A076D1D">
        <Environment Id="PATH" Name="PATH" Value="[INSTALLDIR]bin" Permanent="no" Part="last" Action="set" System="yes" />
        <RegistryValue Root="HKCU" Key="Software\Ephox\bolt" Name="installed" Type="integer" Value="1" KeyPath="yes" />
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="lib">
      <Component Id="lib_compiler.js" Guid="F1C283B2-39C5-11E2-87F0-0026BB5B376C">
        <File Id="lib_compiler.js" Source="lib/compiler.js" KeyPath="yes" />
      </Component>
      <Component Id="lib_inline.js" Guid="F581FC9E-39C5-11E2-9378-0026BB5B376C">
        <File Id="lib_inline.js" Source="lib/inline.js" KeyPath="yes" />
      </Component>
      <Component Id="lib_inline.js.post" Guid="FA83D528-39C5-11E2-A2B1-0026BB5B376C">
        <File Id="lib_inline.js.post" Source="lib/inline.js.post" KeyPath="yes" />
      </Component>
      <Component Id="lib_inline.js.pre" Guid="FED81F9E-39C5-11E2-AE1B-0026BB5B376C">
        <File Id="lib_inline.js.pre" Source="lib/inline.js.pre" KeyPath="yes" />
      </Component>
      <Component Id="lib_kernel.js" Guid="03439E14-39C6-11E2-A2BB-0026BB5B376C">
        <File Id="lib_kernel.js" Source="lib/kernel.js" KeyPath="yes" />
      </Component>
      <Component Id="lib_loader.js" Guid="07DCAA1A-39C6-11E2-91F1-0026BB5B376C">
        <File Id="lib_loader.js" Source="lib/loader.js" KeyPath="yes" />
      </Component>
      <Component Id="lib_module.js" Guid="0C10EC0E-39C6-11E2-8707-0026BB5B376C">
        <File Id="lib_module.js" Source="lib/module.js" KeyPath="yes" />
      </Component>
      <Component Id="lib_test.js" Guid="10186B10-39C6-11E2-8448-0026BB5B376C">
        <File Id="lib_test.js" Source="lib/test.js" KeyPath="yes" />
      </Component>
    </DirectoryRef>

    <DirectoryRef Id="command">
      <Component Id="command_build.js" Guid="1CCCC612-39C6-11E2-81CD-0026BB5B376C">
        <File Id="command_build.js" Source="command/build.js" KeyPath="yes" />
      </Component>
      <Component Id="command_init.js" Guid="21578ECE-39C6-11E2-B2FF-0026BB5B376C">
        <File Id="command_init.js" Source="command/init.js" KeyPath="yes" />
      </Component>
      <Component Id="command_test.js" Guid="2539F0A4-39C6-11E2-8902-0026BB5B376C">
        <File Id="command_test.js" Source="command/test.js" KeyPath="yes" />
      </Component>
    </DirectoryRef>

    <Feature Id="bolt" Level="1">
      <ComponentRef Id="LICENSE" />
      <ComponentRef Id="README.md" />
      <ComponentRef Id="bin_bolt.bat" />
      <ComponentRef Id="bin_bolt.js" />
      <ComponentRef Id="bin_jsc.bat" />
      <ComponentRef Id="bin_jsc.js" />
      <ComponentRef Id="bin_version" />
      <ComponentRef Id="UpdatePath" />
      <ComponentRef Id="lib_compiler.js" />
      <ComponentRef Id="lib_inline.js" />
      <ComponentRef Id="lib_inline.js.post" />
      <ComponentRef Id="lib_inline.js.pre" />
      <ComponentRef Id="lib_kernel.js" />
      <ComponentRef Id="lib_loader.js" />
      <ComponentRef Id="lib_module.js" />
      <ComponentRef Id="lib_test.js" />
      <ComponentRef Id="command_build.js" />
      <ComponentRef Id="command_init.js" />
      <ComponentRef Id="command_test.js" />
    </Feature>
  </Product>
</Wix>
